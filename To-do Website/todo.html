<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>To-Do List</title>

  <!-- Supabase client -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    const { createClient } = supabase
    const supabaseUrl = "https://walsvybskelqhgvpdagj.supabase.co"
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndhbHN2eWJza2VscWhndnBkYWdqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc4MDQyMjUsImV4cCI6MjA3MzM4MDIyNX0.tDaLE2F2gOZnqU06Qt9XvgfeV3Qo9kdhmr-mZem7cV4"
    const supabaseClient = createClient(supabaseUrl, supabaseKey)
  </script>

  <!-- CSS -->
  <link rel="stylesheet" href="todostyles.css">
</head>
<body>
  <header>
    My To-Do Lists
    <div><a href="index.html">‚Üê Back</a></div>
  </header>

  <div class="todo-container">

    <!-- Doing Right Now -->
    <div class="list-box">
      <h2>Doing Right Now</h2>
      <div class="task-box">
        <form onsubmit="event.preventDefault(); addTask(LIST_IDS.doing, 'doingInput','doingDate','doingList');">
          <input type="text" id="doingInput" placeholder="What are you doing now?">
          <input type="text" id="doingDate" placeholder="Optional due date">
          <button type="submit">Set</button>
        </form>
        <ul id="doingList"></ul>
      </div>
    </div>

    <!-- Must Do Today -->
    <div class="list-box">
      <h2>Must Do Today (Max 3)</h2>
      <div class="task-box">
        <form onsubmit="event.preventDefault(); addTask(LIST_IDS.must, 'mustInput','mustDate','mustList',3);">
          <input type="text" id="mustInput" placeholder="Must do item">
          <input type="text" id="mustDate" placeholder="Optional due date">
          <button type="submit">Add</button>
        </form>
        <ul id="mustList"></ul>
      </div>
    </div>

    <!-- Class Lists -->
    <div class="list-box">
      <h2>Class Lists</h2>
      <div class="class-lists">

        <div class="task-box">
          <h3>Discrete II</h3>
          <form onsubmit="event.preventDefault(); addTask(LIST_IDS.discrete,'discreteInput','discreteDate','discreteList');">
            <input type="text" id="discreteInput" placeholder="Add task">
            <input type="text" id="discreteDate" placeholder="Optional due date">
            <button type="submit">Add</button>
          </form>
          <ul id="discreteList"></ul>
        </div>

        <div class="task-box">
          <h3>Calc III</h3>
          <form onsubmit="event.preventDefault(); addTask(LIST_IDS.calc,'calcInput','calcDate','calcList');">
            <input type="text" id="calcInput" placeholder="Add task">
            <input type="text" id="calcDate" placeholder="Optional due date">
            <button type="submit">Add</button>
          </form>
          <ul id="calcList"></ul>
        </div>

        <div class="task-box">
          <h3>Cyber Analysis</h3>
          <form onsubmit="event.preventDefault(); addTask(LIST_IDS.cyber,'cyberInput','cyberDate','cyberList');">
            <input type="text" id="cyberInput" placeholder="Add task">
            <input type="text" id="cyberDate" placeholder="Optional due date">
            <button type="submit">Add</button>
          </form>
          <ul id="cyberList"></ul>
        </div>

        <div class="task-box">
          <h3>Topics in Cyber</h3>
          <form onsubmit="event.preventDefault(); addTask(LIST_IDS.topics,'topicsInput','topicsDate','topicsList');">
            <input type="text" id="topicsInput" placeholder="Add task">
            <input type="text" id="topicsDate" placeholder="Optional due date">
            <button type="submit">Add</button>
          </form>
          <ul id="topicsList"></ul>
        </div>

      </div>
    </div>

    <!-- Other Important Lists -->
    <div class="list-box">
      <h2>Other Important Lists</h2>
      <div class="class-lists">

        <div class="task-box">
          <h3>
            <span id="otherTitle1">Important 1</span>
            <button type="button" onclick="editTitle('otherTitle1', LIST_IDS.other1)">‚úèÔ∏è</button>
          </h3>
          <form onsubmit="event.preventDefault(); addTask(LIST_IDS.other1,'otherInput1','otherDate1','otherList1');">
            <input type="text" id="otherInput1" placeholder="Add task">
            <input type="text" id="otherDate1" placeholder="Optional due date">
            <button type="submit">Add</button>
          </form>
          <ul id="otherList1"></ul>
        </div>

        <div class="task-box">
          <h3>
            <span id="otherTitle2">Important 2</span>
            <button type="button" onclick="editTitle('otherTitle2', LIST_IDS.other2)">‚úèÔ∏è</button>
          </h3>
          <form onsubmit="event.preventDefault(); addTask(LIST_IDS.other2,'otherInput2','otherDate2','otherList2');">
            <input type="text" id="otherInput2" placeholder="Add task">
            <input type="text" id="otherDate2" placeholder="Optional due date">
            <button type="submit">Add</button>
          </form>
          <ul id="otherList2"></ul>
        </div>

        <div class="task-box">
          <h3>
            <span id="otherTitle3">Important 3</span>
            <button type="button" onclick="editTitle('otherTitle3', LIST_IDS.other3)">‚úèÔ∏è</button>
          </h3>
          <form onsubmit="event.preventDefault(); addTask(LIST_IDS.other3,'otherInput3','otherDate3','otherList3');">
            <input type="text" id="otherInput3" placeholder="Add task">
            <input type="text" id="otherDate3" placeholder="Optional due date">
            <button type="submit">Add</button>
          </form>
          <ul id="otherList3"></ul>
        </div>

        <div class="task-box">
          <h3>
            <span id="otherTitle4">Important 4</span>
            <button type="button" onclick="editTitle('otherTitle4', LIST_IDS.other4)">‚úèÔ∏è</button>
          </h3>
          <form onsubmit="event.preventDefault(); addTask(LIST_IDS.other4,'otherInput4','otherDate4','otherList4');">
            <input type="text" id="otherInput4" placeholder="Add task">
            <input type="text" id="otherDate4" placeholder="Optional due date">
            <button type="submit">Add</button>
          </form>
          <ul id="otherList4"></ul>
        </div>

      </div>
    </div>

  </div>

  <script>
    // üëá These are the UUIDs you gave me
    const LIST_IDS = {
      doing:    "b093c6d8-9ed6-41ec-9667-2467066b84d3", // Doing Right Now
      must:     "df9db72b-b8ee-4178-bc1d-e5f55c9dcca7", // Must Do Today
      discrete: "6226fc41-18d7-46af-95c3-4b320300b793", // Discrete II
      calc:     "401cf998-6e39-4581-a2b6-0bc9655870cf", // Calc III
      cyber:    "3a396ff1-962b-4357-91ff-d19fefa4a3ac", // Cyber Analysis
      topics:   "61d6d0f2-2112-4cb2-9ee8-17119b631756", // Topics in Cyber
      other1:   "32dd9a59-8fa4-45f3-a20f-e801549179d1", // Important 1
      other2:   "2ff32464-e2a3-43c5-adfc-cbe17439ad7d", // Important 2
      other3:   "63d46c8e-16f1-4c88-b4e8-09fdfa9e93fe", // Important 3
      other4:   "e88dc7fa-6815-4eb9-8d02-cd5c023d853f"  // Important 4
    }

    // Load all tasks + titles at startup
    document.addEventListener("DOMContentLoaded", loadAllData)

    async function loadAllData() {
      // Load titles
      const { data: lists } = await supabaseClient.from("lists").select("id,title")
      if (lists) {
        for (let l of lists) {
          // update the <span> if it exists
          const key = Object.keys(LIST_IDS).find(k => LIST_IDS[k] === l.id)
          if (key && document.getElementById(key.replace("other","otherTitle"))) {
            document.getElementById(key.replace("other","otherTitle")).textContent = l.title
          }
        }
      }
      // Load tasks
      loadAllTasks()
    }

    async function loadAllTasks() {
      for (const [key, listId] of Object.entries(LIST_IDS)) {
        const { data: tasks, error } = await supabaseClient
          .from("tasks")
          .select("*")
          .eq("list_id", listId)
          .order("created_at")

        if (error) { console.error(error); continue }

        const ul = document.getElementById(key + "List")
        if (!ul) continue
        ul.innerHTML = ""

        tasks.forEach(task => {
          const li = document.createElement("li")
          li.textContent = task.content + (task.due_date ? " @ " + task.due_date : "")

          const btn = document.createElement("button")
          btn.textContent = "Done"
          btn.classList.add("done")
          btn.onclick = async function() {
            await supabaseClient.from("tasks").delete().eq("id", task.id)
            li.remove()
          }

          li.appendChild(btn)
          ul.appendChild(li)
        })
      }
    }

    async function addTask(listId, inputId, dateId, ulId, maxItems) {
      const input = document.getElementById(inputId).value.trim()
      const date = document.getElementById(dateId).value.trim()
      if (input === "") return

      const ul = document.getElementById(ulId)
      if (maxItems && ul.children.length >= maxItems) {
        alert("Max items reached!")
        return
      }

      const { error } = await supabaseClient.from("tasks").insert([
        { list_id: listId, content: input, due_date: date || null }
      ])

      if (!error) {
        document.getElementById(inputId).value = ""
        document.getElementById(dateId).value = ""
        loadAllTasks()
      } else {
        console.error(error)
      }
    }

    // Editable titles for Other Important Lists (save to Supabase)
    async function editTitle(spanId, listId) {
      let span = document.getElementById(spanId)
      let current = span.textContent
      let newTitle = prompt("Enter new title:", current)

      if (newTitle !== null && newTitle.trim() !== "") {
        span.textContent = newTitle.trim()
        const { error } = await supabaseClient
          .from("lists")
          .update({ title: newTitle.trim() })
          .eq("id", listId)
        if (error) {
          console.error("Error updating title:", error)
          alert("Could not save title to Supabase!")
        }
      }
    }
  </script>
</body>
</html>
